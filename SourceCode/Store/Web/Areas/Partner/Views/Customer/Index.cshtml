@using Model
@model CustomerModel
@{
    ViewBag.Title = "Đối tác - khách hàng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row page-header">
    <div class="col-md-9 col-sm-8 col-xs-12">
        <h4 style="float:left;">Đối tác - Khách hàng</h4>
    </div>
    <div class="col-md-3 col-sm-4 col-xs-12 page-tool">
        <span id="btnAdd" data-tooltip="Thêm mới" title="Thêm mới"><i class="fa fa-plus-circle" aria-hidden="true"></i></span>
        <span id="deleteBtn" title="Xóa"><i class="fa fa-window-close" aria-hidden="true"></i></span>
    </div>
</div>
<div class="row">

</div>
<div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
        <table id="example" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>Mã KH</th>
                    <th>Tên KH</th>
                    <th>Giới tính</th>
                    <th>SDT</th>
                    <th>Địa chỉ</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div id="divContainer">

</div>


@section script{
    <script>
    var selected = [];
    $(document).ready(function () {

        $('#example').DataTable({
            responsive: true,
            processing: true,
            serverSide: false,
            searching: true,
            ordering: true,
            paging: true,
            pageLength: 10,
            pagingType: 'full_numbers',
            info: true,
            initComplete: function (settings, json) {
                //Do something after finish
            },
            language: {
                lengthMenu: 'Hiển thị _MENU_ dòng mỗi trang',
                zeroRecords: 'Dữ liệu không tồn tại',
                info: 'Trang _PAGE_/_PAGES_',
                infoEmpty: '',//'Không tìm thấy kết quả',
                infoFiltered: '',//'(Tìm kiếm trên _MAX_ dòng)',
                search: 'Tìm kiếm',
                processing: 'Đang xử lý',
                paginate: {
                    first: '<<',
                    previous: '<',
                    next: '>',
                    last: '>>'
                }
            },
            order: [[1, "asc"]],
            ajax: {
                url: '/partner/customer/index',
                type: 'post',
                data: function (d) {
                    //d.ModuleCode = $('#moduleCode').val()
                }
            },
            columns: [
                {
                    orderable: false,
                    width: '40px',
                    render: function (obj, type, data, meta) {
                        var index = meta.row + meta.settings._iDisplayStart + 1;
                        return '<div class="ctn-center text-bold">' + index + '<div/>';
                    }
                },
                {
                    data: 'Code',
                    orderable: true,
                    searchable: true,
                    width: '100px'
                },
                {
                    data: 'Name',
                    orderable: true,
                    searchable: true,
                    width: '200px'
                },
                {
                    data: 'GenderString',
                    orderable: true,
                    searchable: true,
                    width: '50px'
                },
                {
                    data: 'Phone',
                    orderable: true,
                    searchable: true,
                    width: '80px'
                },
                {
                    data: 'Address',
                    orderable: true,
                    searchable: true
                }
            ]
        });

        //LocationName
        $("#LocationName").autocomplete({
            source: function (request, response) {
                $.ajax({
                    url: '@Url.Action("FindLocationByName", "Customer", new { Area = "Partner" })',
                    datatype: "json",
                    data: {
                        name: request.term
                    },
                    success: function (data) {
                        response($.map(data, function (val, item) {
                            return {
                                label: val.Name,
                                value: val.ID,
                                id: val.ID
                            }
                        }))
                    }
                })
            },
            select: function (event, ui) {
                event.preventDefault();
                $("#LocationName").val(ui.item.label);
                $("#LocationID").val(ui.item.id);
            },
            focus: function (event, ui) {
                event.preventDefault();
                $("#LocationName").val(ui.item.label);
            }
        });
    });

    $('#example tbody').on('click', 'tr', function () {
        console.log('ok');
        var id = this.id;
        var index = $.inArray(id, selected);

        if (index === -1) {
            selected.push(id);
        } else {
            selected.splice(index, 1);
        }

        $(this).toggleClass('selected');
    });


    $(document).on('click', '#btnAdd', function (e) {
        $('#loadingModel').modal('show');
        $.ajax({
            url: '/partner/customer/add',
            type: 'get',
            dataType: 'html',
            success: function (result) {
                $('#divContainer').html(result);
                $('#loadingModel').modal('hide');
            }
        });
    });

    $('#inputModel').submit(function () {
        if ($(this).valid()) {
            $.ajax({
                url: this.action,
                type: this.method,
                data: $(this).serialize(),
                success: function (result) {
                    //$('#result').html(result);
                    console.log(result);
                },
                error: function (xhr) {
                    console.log(xhr);
                }
            });
        }
        return false;
    });

    $(function () {
        $('#Birthdate').datetimepicker({
            format: 'DD/MM/YYYY'
        });
    });
</script>
}